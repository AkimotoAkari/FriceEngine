package org.frice.game.utils.data

import org.frice.game.utils.kotlin.forceRun
import java.io.File
import java.util.*

/**
 * Created by ice1000 on 2016/8/20.
 *
 * @author ice1000
 * @since v0.4.1
 */
class Preference(private val file: File) : Database {

	constructor(path: String) : this(File(path))

	val properties: Properties = Properties()

	init {
		if (!file.exists()) file.createNewFile()
		forceRun { properties.load(file.inputStream()) }
	}

	override fun query(key: String, default: Any) = when (properties[key] as String) {
		"true" -> true
		"false" -> false
		else -> try {
			Integer.parseInt(properties[key] as String)
		} catch (e: Throwable) {
			properties[key] ?: default
		}
	}

	override fun insert(key: String, value: Any?) {
		properties.put(key, value.toString())
		properties.store(file.outputStream(), "Automatically generated by ice1000 Frice Engine")
	}

	fun list() = properties.toList()
}